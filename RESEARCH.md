<div>Standaard ElasticSearch Docker image:</div><ul><li><a href="https://registry.hub.docker.com/u/dockerfile/elasticsearch/">https://registry.hub.docker.com/u/dockerfile/elasticsearch/</a></li></ul><div>Artikel over ELK stack (Elastic Search, LogStash en Kibana)</div><ul><li><a href="https://clusterhq.com/blog/deploying-multi-node-elasticsearch-logstash-kibana-cluster-using-docker/">https://clusterhq.com/blog/deploying-multi-node-elasticsearch-logstash-kibana-cluster-using-docker/</a></li></ul><div>Flocker (docker container management)</div><ul><li><a href="https://github.com/ClusterHQ/flocker">https://github.com/ClusterHQ/flocker</a></li><li>wel interessant voor mgmt, maar onderzoek op zichzelf om het allemaal in te kunnen zetten</li></ul><div><br/></div><div><u><b>De ELK stack</b></u></div><div>Welke componenten zijn er allemaal nodig?<br/></div><div>Alleen Elastic Search voor opslag en Kiana voor ES integration en opvragen (logstash is het voorbeeld waarvoor ES als opslag wordt gebruikt</div><div><br/></div><ul><li>standaard elastic search image</li><li>persistent storage op local storage per docker container (volgnummer)</li><li style="display:inline;list-style:none;"><ul><li>/var/appdata/es_node_1</li></ul></li></ul><div><h4 style="font-family: &amp;apos;Helvetica Neue&amp;apos;, HelveticaNeue, TeXGyreHeros, FreeSans, &amp;apos;Nimbus Sans L&amp;apos;, &amp;apos;Liberation Sans&amp;apos;, Arimo, Helvetica, Arial, sans-serif; font-weight: 400; color: rgb(57, 77, 84); text-rendering: optimizelegibility; font-size: 16px;">Attach persistent/shared directories</h4><ol style="color: rgb(57, 77, 84); font-family: &amp;apos;Helvetica Neue&amp;apos;, HelveticaNeue, TeXGyreHeros, FreeSans, &amp;apos;Nimbus Sans L&amp;apos;, &amp;apos;Liberation Sans&amp;apos;, Arimo, Helvetica, Arial, sans-serif;"><li><p style="font-weight: 400; color: rgb(57, 77, 84);">Create a mountable data directory&nbsp;&nbsp;<code style="padding: 2px 4px; font-family: Monaco, Menlo, Consolas, &amp;apos;Courier New&amp;apos;, monospace; font-size: 12px; color: rgb(221, 17, 68); background-color: rgb(247, 247, 249); border: 1px solid rgb(225, 225, 232); white-space: pre-line;">&lt;data-dir&gt;</code>&nbsp;&nbsp;on the host.</p></li><li><p style="font-weight: 400; color: rgb(57, 77, 84);">Create ElasticSearch config file at&nbsp;&nbsp;<code style="padding: 2px 4px; font-family: Monaco, Menlo, Consolas, &amp;apos;Courier New&amp;apos;, monospace; font-size: 12px; color: rgb(221, 17, 68); background-color: rgb(247, 247, 249); border: 1px solid rgb(225, 225, 232); white-space: pre-line;">&lt;data-dir&gt;/elasticsearch.yml</code>.</p><pre style="padding: 0.35em; font-family: Monaco, Menlo, Consolas, &amp;apos;Courier New&amp;apos;, monospace; font-size: 13px; color: rgb(51, 51, 51); word-break: break-all; word-wrap: break-word; white-space: pre-wrap; background-color: rgb(245, 245, 245); border: 1px solid rgba(0, 0, 0, 0.14902);"><code style="padding: 0.5em; font-family: Monaco, Menlo, Consolas, &amp;apos;Courier New&amp;apos;, monospace; font-size: 12px; color: black; background-color: rgb(240, 240, 240); border: 0px; white-space: pre-wrap; background-position: initial initial; background-repeat: initial initial;">path:
  logs: /data/log
  data: /data/data</code></pre></li><li><p style="font-weight: 400; color: rgb(57, 77, 84);">Start a container by mounting data directory and specifying the custom configuration file:</p><div style="background-color: rgb(248, 248, 248); background-position: initial initial; background-repeat: initial initial;"><pre style="padding: 0.35em; font-family: Monaco, Menlo, Consolas, &amp;apos;Courier New&amp;apos;, monospace; font-size: 13px; color: rgb(51, 51, 51); word-break: break-all; word-wrap: break-word; white-space: pre-wrap; background-color: rgb(245, 245, 245); border: 1px solid rgba(0, 0, 0, 0.14902);">
docker run -d -p 9200:9200 -p 9300:9300 -v &lt;data-dir&gt;:/data dockerfile/elasticsearch /elasticsearch/bin/elasticsearch -Des.config<span style="color: rgb(102, 102, 102);">=</span>/data/elasticsearch.yml

</pre></div></li></ol><p style="color: rgb(57, 77, 84); font-family: &amp;apos;Helvetica Neue&amp;apos;, HelveticaNeue, TeXGyreHeros, FreeSans, &amp;apos;Nimbus Sans L&amp;apos;, &amp;apos;Liberation Sans&amp;apos;, Arimo, Helvetica, Arial, sans-serif;">After few seconds, open&nbsp;&nbsp;<code style="padding: 2px 4px; font-family: Monaco, Menlo, Consolas, &amp;apos;Courier New&amp;apos;, monospace; font-size: 12px; color: rgb(221, 17, 68); background-color: rgb(247, 247, 249); border: 1px solid rgb(225, 225, 232); white-space: pre-line;">http://&lt;host&gt;:9200</code>&nbsp;&nbsp;to see the result.</p></div><div><br/></div><div><input checked="true" type="checkbox"/>script prepare_container.sh om data directory’s te maken</div><div><input checked="true" type="checkbox"/>Fig installatie</div><ul><li>op gima-yoda2.so.kadaster.nl</li><li>als root</li><li><span style="font-family: &amp;apos;Andale Mono&amp;apos;;">export https_proxy=“www-proxy.cs.kadaster.nl:8082"</span></li><li><span style="font-family: &amp;apos;Andale Mono&amp;apos;;">curl -L --insecure <a href="https://github.com/docker/fig/releases/download/1.0.1/fig-%60uname">https://github.com/docker/fig/releases/download/1.0.1/fig-`uname</a> -s`-`uname -m` &gt; /usr/local/bin/fig; chmod +x /usr/local/bin/fig</span></li><li>geslaagd!</li></ul><div><input type="checkbox"/>Elastic Search cluster configuratie</div><ul><li>default maakt ie een cluster genaamd elasticsearch en vindt zijn ‘collega’s'</li><li style="display:inline;list-style:none;"><ul><li><input checked="true" type="checkbox"/>cluster naam gezet op gimabigdata</li></ul></li><li><input type="checkbox"/>testen of dit werkt met 2 docker hosts of het 1 cluster wordt</li><li style="display:inline;list-style:none;"><ul><li>nee, werkt niet, ander subnet, zien elkaar niet</li><li>run optie <span style="font-family: &amp;apos;Andale Mono&amp;apos;;">--net=host</span></li><li>elastic search begint zelf bij poort 9200 en zoekt eerstvolgende vrije poort</li><li>zie gima-yoda5 voor elasticsearch.yml met goede clusterconfig (unicast ipv multicast)</li></ul></li><li><a href="http://stackoverflow.com/questions/16821101/how-to-set-up-es-cluster">http://stackoverflow.com/questions/16821101/how-to-set-up-es-cluster</a></li><li>configuratieopties</li><li style="display:inline;list-style:none;"><ul><li><a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/setup-configuration.html">http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/setup-configuration.html</a></li><li><a href="https://github.com/elasticsearch/elasticsearch/blob/master/config/elasticsearch.yml">https://github.com/elasticsearch/elasticsearch/blob/master/config/elasticsearch.yml</a><br/></li></ul></li><li>http toegang vanaf kibana mogelijk maken:</li><li style="display:inline;list-style:none;"><ul><li><a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/modules-http.html">http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/modules-http.html</a><br/></li><li><a href="https://gist.github.com/rmoff/379e6ce46eb128110f38">https://gist.github.com/rmoff/379e6ce46eb128110f38</a></li><li><input checked="true" type="checkbox"/>in elastic search.yml in preparenodes.sh aangepast</li></ul></li></ul><div><input checked="true" type="checkbox"/>fig.yml voor elasticsearch nodes</div><ul><li>fig werkt niet, kan docker niet vinden</li><li><span style="font-family: &amp;apos;Andale Mono&amp;apos;;">export DOCKER_HOST=tcp://localhost:2375</span></li><li>nu werkt het wel!</li><li>fig.yml heeft config voor 4 ES nodes op poorten 920[0..3] en 930[0..3]</li></ul><div><input checked="true" type="checkbox"/>nginx configuratie werkt niet -&gt; geen kibana meer, vervalt</div><ul><li><a href="http://serverfault.com/questions/564546/nginx-doesnt-start-after-installation">http://serverfault.com/questions/564546/nginx-doesnt-start-after-installation</a></li><li>in /etc/nginx/sites-enabled/default file</li><li style="display:inline;list-style:none;"><ul><li>ipv6 deel uncomment</li><li>de [::]:80 regel is een ip v6 adres regexp en wordt niet ondersteund door onze installatie</li><li>kibana site staat op : /usr/share/nginx/html</li><li>met de hand /usr/local/bin/run starten</li></ul></li><li><input type="checkbox"/>dit zit allemaal nog niet in de image!</li></ul><div><input checked="true" type="checkbox"/>Kibana configuratie -&gt; niet meer nodig</div><ul><li>werkt niet met default Elastic Search installatie</li><li>aangepaste Dockerfile, maar heeft standaard een logsmash dashboard, weinig geschikt</li></ul><div><input type="checkbox"/>Marvel ElasticSearch dashboard</div><ul><li>is een plugin</li><li><a href="http://www.elasticsearch.org/overview/marvel/download/">http://www.elasticsearch.org/overview/marvel/download/</a></li><li><a href="http://www.elasticsearch.org/guide/en/marvel/current/_installation.html">http://www.elasticsearch.org/guide/en/marvel/current/_installation.html</a></li><li>gima/es image gemaakt met internet toegang voor de jvm</li><li>plugin handmatig unzippen in de juiste directory en elasticsearch.yml aangepast voor plugin directory anders wordt dit niet opgepakt</li><li>ziet vanzelf het hele cluster</li></ul><div><br/></div><div><br/></div>
